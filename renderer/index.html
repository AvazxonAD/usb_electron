<!DOCTYPE html>
<html>
  <body>
    <h3>E-IMZO list_disks test</h3>
    <button id="btn">List Disks</button>
    <pre id="out"></pre>

    <script src="./CAPIWS.js"></script>
    <script>
      const tokens = [];
      const certifictes = [];
      CAPIWS.callFunction(
        {
          plugin: "ftjc",
          name: "list_tokens",
        },
        function (event, data) {
          tokens.push(data);
        },
        function (error) {
          window.alert(error);
        }
      );

      CAPIWS.callFunction(
        {
          plugin: "pfx",
          name: "list_disks",
        },
        function (event, data) {
          tokens.push(data);
        },
        function (error) {
          window.alert(error);
        }
      );

      CAPIWS.callFunction(
        {
          plugin: "certkey",
          name: "list_disks",
        },
        function (event, data) {
          tokens.push(data);
        },
        function (error) {
          window.alert(error);
        }
      );

      CAPIWS.callFunction(
        {
          plugin: "ytks",
          name: "list_disks",
        },
        function (event, data) {
          tokens.push(data);
          console.log("Tokens");
          console.log(tokens);
        },
        function (error) {
          window.alert(error);
        }
      );

      CAPIWS.callFunction(
        {
          plugin: "idcard",
          name: "list_readers",
        },
        function (event, data) {
          console.log("Readers");
          console.log(data);
        },
        function (error) {
          window.alert(error);
        }
      );

      CAPIWS.callFunction(
        {
          plugin: "idcard",
          name: "list_all_certificates",
        },
        function (event, data) {
          certifictes.push(data);
        },
        function (error) {
          window.alert(error);
        }
      );

      CAPIWS.callFunction(
        {
          plugin: "pfx",
          name: "list_all_certificates",
        },
        function (event, data) {
          certifictes.push(data);
        },
        function (error) {
          window.alert(error);
        }
      );
      CAPIWS.callFunction(
        {
          plugin: "certkey",
          name: "list_all_certificates",
        },
        function (event, data) {
          certifictes.push(data);
        },
        function (error) {
          window.alert(error);
        }
      );

      CAPIWS.callFunction(
        {
          plugin: "ytks",
          name: "list_all_certificates",
        },
        function (event, data) {
          certifictes.push(data);
          console.log("Certificates");
          for (let c of certifictes) {
            if (c.certificates[0]) {
              console.log(c.certificates[0]);
            }
          }
        },
        function (error) {
          window.alert(error);
        }
      );
    </script>
  </body>
</html>
